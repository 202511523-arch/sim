export const PartMetadata = {
  // --- V4 Engine Specific ---
  v4Engine: {
    '솔리드1003_22': { name: 'Piston', description: 'Core component that converts combustion chamber pressure into mechanical force.' },
    '솔리드1003_24': { name: 'Piston', description: 'Core component that converts combustion chamber pressure into mechanical force.' },
    '솔리드1003_15': { name: 'Piston', description: 'Core component that converts combustion chamber pressure into mechanical force.' },
    '솔리드1003_3': { name: 'Piston', description: 'Core component that converts combustion chamber pressure into mechanical force.' },

    '솔리드1003_23': { name: 'Connecting Rod', description: 'Connects the piston to the crankshaft, converting reciprocating motion into rotary motion.' },
    '솔리드1003_25': { name: 'Connecting Rod', description: 'Connects the piston to the crankshaft, converting reciprocating motion into rotary motion.' },
    '솔리드1003_16': { name: 'Connecting Rod', description: 'Connects the piston to the crankshaft, converting reciprocating motion into rotary motion.' },
    '솔리드1003_4': { name: 'Connecting Rod', description: 'Connects the piston to the crankshaft, converting reciprocating motion into rotary motion.' },

    '솔리드1003_19': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_28': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_12': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_7': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_20': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_29': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_13': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },
    '솔리드1003_8': { name: 'Crankshaft', description: 'Core shaft that transfers power by converting reciprocating motion into rotary motion.' },

    '솔리드1003_17': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_18': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_27': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_26': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_10': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_11': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_6': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },
    '솔리드1003_5': { name: 'Bolt', description: 'Precision machined bolt maintaining a secure connection between components.' },

    '솔리드1003_1': { name: 'Engine Block', description: 'The main body of the engine containing cylinders and cooling passages.' },
    '솔리드1003_2': { name: 'Engine Block', description: 'The main body of the engine containing cylinders and cooling passages.' }
  },

  // --- Robot Gripper Specific ---
  robotGripper: {
    'Solid1008': { name: 'Gripper Base', description: 'The main structure of the gripper attached to the robot arm end.' },
    'Solid1007': { name: 'Hinge', description: 'A rotational hinge component allowing finger movement.' },
    'Solid1011': { name: 'Finger', description: 'A finger component used for directly grasping objects.' },
    'Solid1016': { name: 'Finger', description: 'A finger component used for directly grasping objects.' },
    'Solid1002': { name: 'Base Gear', description: 'A drive gear that transfers rotational force to finger movement.' },
    'Solid1010': { name: 'Gear Link', description: 'A link connecting the gear and finger to perform opening and closing functions.' },
    'Solid1009': { name: 'Gear Link', description: 'A link connecting the gear and finger to perform opening and closing functions.' },
    'Solid1012': { name: 'Link', description: 'An auxiliary link structure used for precise movement of the fingers.' },
    'Solid1001': { name: 'Link', description: 'An auxiliary link structure used for precise movement of the fingers.' },

    'Solid1015': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1023': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1021': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1022': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1020': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1019': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1017': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1018': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1014': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' },
    'Solid1013': { name: 'Pin', description: 'A pin serving as the rotational axis for joints and links.' }
  },

  // --- Robot Arm Specific ---
  robotArm: {
    'Solid1_2': { name: 'Base', description: 'A lower support structure supporting the entire load of the robot.' },
    'Solid1_1': { name: 'Base', description: 'A lower support structure supporting the entire load of the robot.' },
    'Solid1_3': { name: 'Axis 1', description: 'The first rotational joint of the robot arm.' },
    'Solid1_1001': { name: 'Axis 1', description: 'The first rotational joint of the robot arm.' },
    'Solid1_2002': { name: 'Axis 2', description: 'The second rotational joint (Pitching Axis) of the robot arm.' },
    'Solid1_3001': { name: 'Axis 2', description: 'The second rotational joint (Pitching Axis) of the robot arm.' },
    'Solid1_1002': { name: 'Axis 2', description: 'The second rotational joint (Pitching Axis) of the robot arm.' },

    // Additional Robot Arm Parts
    'Solid1001': { name: 'Link', description: 'Structural arm component (링크).' },
    'Solid1001_1': { name: 'Link', description: 'Structural arm component (링크).' },
    'Solid1002': { name: 'Vertical Joint', description: 'A vertical rotation joint (관절(상하)).' },
    'Solid1002_1': { name: 'Vertical Joint', description: 'A vertical rotation joint (관절(상하)).' },
    'Solid1003': { name: 'Link', description: 'Structural arm component (링크).' },
    'Solid1004': { name: 'Link', description: 'Structural arm component (링크).' },
    'Solid1005': { name: 'Vertical Joint', description: 'A vertical rotation joint (관절(상하)).' },
    'Solid1006': { name: 'Horizontal Joint', description: 'A horizontal rotation joint (관절(좌우)).' },
    'Solid1011': { name: 'Gripper', description: 'The end effector for grasping objects (집게).' }
  },

  // --- Leaf Spring Specific ---
  leafSpring: {
    'Solid2001_3': { name: 'Center Clamp', description: 'A device that securely fixes the leaf spring to the axle.' },
    'Solid1029': { name: 'Sub Clamp', description: 'A clamp used to keep stacked springs in alignment.' },
    'Solid1030': { name: 'Sub Clamp', description: 'A clamp used to keep stacked springs in alignment.' },
    'Solid1032': { name: 'Sub Clamp', description: 'A clamp used to keep stacked springs in alignment.' },
    'Solid1033': { name: 'Sub Clamp', description: 'A clamp used to keep stacked springs in alignment.' },
    'Solid1031_1': { name: 'Spring Leaf Pack', description: 'A laminated steel structure that absorbs shock using elastic energy.' },
    'Solid1007': { name: 'Support Rubber', description: 'A rubber pad providing noise prevention and damping.' },
    'Solid1013': { name: 'Support Rubber', description: 'A rubber pad providing noise prevention and damping.' },
    'Solid1014': { name: 'Support Rubber', description: 'A rubber pad providing noise prevention and damping.' },
    'Solid1': { name: 'Spring Support', description: 'A structure supporting the connection between the vehicle body and leaf spring.' },
    'Solid1001': { name: 'Spring Support', description: 'A structure supporting the connection between the vehicle body and leaf spring.' },
    'Solid2': { name: 'Support Rigid', description: 'High-strength frame connection with high rigidity.' },
    'Solid2002': { name: 'Support Rigid', description: 'High-strength frame connection with high rigidity.' },
    'Solid2001_2': { name: 'Main Clamp', description: 'A clamp used to keep stacked springs in alignment.' }
  },

  // --- Suspension Specific ---
  suspension: {
    'Solid1020_1': { name: 'Suspension Base', description: 'The bottom base supporting the shock absorbing device.' },
    'SOLID1020': { name: 'Suspension Base', description: 'The bottom base supporting the shock absorbing device.' },
    'Solid1007': { name: 'Piston Rod', description: 'A precision piston shaft that transfers damping force via reciprocating motion.' },
    'Solid1008': { name: 'Coil Spring', description: 'An elastic spring that supports vehicle weight and absorbs shock.' },
    'Solid1002': { name: 'Nut', description: 'A precision screw part that secures the top portion to the mount.' }
  },

  common: {
    hex_bolt: { name: 'Hex Bolt', description: 'A standard fastener component made of high-strength carbon steel.' },
    flange: { name: 'Bolted Flange', description: 'A flange structure that increases the rigidity of the joint surface.' }
  }
};

/**
 * Robust Normalization (v3.3)
 * Handles Blender indexing differences (.001 -> _2)
 */
export const normalizePartName = (str) => {
  if (!str) return '';
  let s = str.toString().toLowerCase();

  // 1. Detect Blender-style indexing (e.g., Solid1.001)
  const blenderMatch = s.match(/(.+)\.(\d{3})$/);
  if (blenderMatch) {
    const prefix = blenderMatch[1].replace(/[^a-z0-9]/g, '');
    const index = parseInt(blenderMatch[2], 10) + 1;
    return prefix + index;
  }

  // 2. Detect implicit index 1 (e.g., Solid1)
  // If it's a typical generic name without suffix, it maps to CAD index 1
  if (s.match(/^(solid|part|mesh|body)\d+$/)) {
    return s.replace(/[^a-z0-9]/g, '') + '1';
  }

  // 3. General normalization (allow alphanumeric, underscore, and Korean)
  // Remove spaces and special chars that are NOT underscore or dot
  return s.replace(/[^a-z0-9가-힣_.]/g, '');
};

export function getPartInfo(childName, section = 'common') {
  if (!childName) return { name: 'Component', description: 'No description available for this part.' };

  const metadata = PartMetadata[section] || PartMetadata.common;
  const target = normalizePartName(childName);

  // 1. Exact match on normalized
  for (const key in metadata) {
    if (normalizePartName(key) === target) return metadata[key];
  }

  // 2. Substring match fallback (for cases where technical names have different prefixes)
  // Only if target is long enough to be unique
  if (target.length > 5) {
    for (const key in metadata) {
      const normKey = normalizePartName(key);
      if (target.endsWith(normKey) || normKey.endsWith(target)) return metadata[key];
    }
  }

  return { name: childName, description: 'No description available for this part.' };
}
